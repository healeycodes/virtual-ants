<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Ants</title>
    <style>
        /* Remove top/left whitespace */
        * {
            margin: 0;
            padding: 0;
        }

        /* Ensure we're full screen*/
        html,
        body {
            width: 100%;
            height: 100%;
        }

        /* Remove scrollbars */
        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="screen"></canvas>
    <script>
        const WIDTH = window.innerWidth
        const HEIGHT = window.innerHeight
        const ANT_DIRECTIONS = ['u', 'r', 'd', 'l']
        const ANT_CHANCE = 0.00035
        const WHITE = 0
        const BLACK = 1

        const canvas = document.querySelector('#screen');
        canvas.width = WIDTH
        canvas.height = HEIGHT

        const ctx = canvas.getContext('2d');
        ctx.scale(2, 2)

        function clear() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        const boardXY = []
        for (let i = 0; i < WIDTH; i++) {
            boardXY.push((new Array(HEIGHT).fill(WHITE)))
        }

        const ants = [] // [x, y, direction]
        for (let x = 0; x < WIDTH; x++) {
            for (let y = 0; y < HEIGHT; y++) {
                // Should we create an ant?
                if (Math.random() < ANT_CHANCE) {
                    // What's the ant's starting direction
                    ants.push([x, y, ANT_DIRECTIONS[Math.floor(Math.random() * ANT_DIRECTIONS.length)]])
                }
            }
        }

        function step() {
            for (let i = 0; i < ants.length; i++) {
                let x = ants[i][0]
                let y = ants[i][1]
                let dir = ants[i][2]

                if (boardXY[x][y] === WHITE) {
                    boardXY[x][y] = BLACK
                    dir = ANT_DIRECTIONS[(ANT_DIRECTIONS.indexOf(dir) + 1) % ANT_DIRECTIONS.length]
                    ctx.fillStyle = 'black'
                } else if (boardXY[x][y] === BLACK) {
                    boardXY[x][y] = WHITE
                    dir = ANT_DIRECTIONS[(ANT_DIRECTIONS.indexOf(dir) - 1) % ANT_DIRECTIONS.length]
                    ctx.fillStyle = 'white'
                }
                ctx.fillRect(x, y, 1, 1);

                if (dir === 'u') {
                    y -= 1
                } else if (dir === 'r') {
                    x += 1
                } else if (dir === 'd') {
                    y += 1
                } else if (dir === 'l') {
                    x -= 1
                }

                if (x >= WIDTH) {
                    x = 0
                } else if (x < 0) {
                    x = WIDTH - 1
                }
                if (y >= HEIGHT) {
                    y = 0
                } else if (y < 0) {
                    y = HEIGHT - 1
                }

                ants[i] = [x, y, dir]
            }
            requestAnimationFrame(step)
        }

        step()
    </script>
</body>

</html>